!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("sceneBlocking",[],e):"object"==typeof exports?exports.sceneBlocking=e():t.sceneBlocking=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Context:()=>M,demo:()=>F});const s={degree:0,scaleX:1,scaleY:1,hide:!1,enabled:!0},i={color:"var(--scene-base-inv-s2)",width:1},n={style:"default",shouldDisplayName:!0,orderIndex:0,namePosition:"top",nameScale:1,nameXOffset:0,nameYOffset:0,excludeKeys:[]},o=["name","color","type","frameAnimationConfig","script","steps","note","shouldDisplayName","id","images","orderIndex","namePosition","nameScale","nameXOffset","nameYOffset","excludeKeys","nameColor"];var a;!function(t){t.TABLE="TABLE",t.LIGHT="LIGHT",t.CHARACTER="CHARACTER",t.CAMERA="CAMERA",t.DISPLAY="DISPLAY",t.CHAIR="CHAIR",t.SHELF="SHELF",t.MAP="MAP",t.SCRIPT="SCRIPT",t.STORYBOARD="STORYBOARD"}(a||(a={}));const r={TABLE:{default:{enabledPaths:'<path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>',disabledPaths:'<path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>\n  <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995z"/>'},triangle:{enabledPaths:'<path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>',disabledPaths:'<path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>\n  <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995z"/>'},fillTriangle:{enabledPaths:'<path fill-rule="evenodd" d="M7.022 1.566a1.13 1.13 0 0 1 1.96 0l6.857 11.667c.457.778-.092 1.767-.98 1.767H1.144c-.889 0-1.437-.99-.98-1.767L7.022 1.566z"/>',disabledPaths:'<path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>'},square:{enabledPaths:'<path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>',disabledPaths:'<path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>\n  <path d="M11.354 4.646a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708l6-6a.5.5 0 0 1 .708 0z"/>'},fillSquare:{enabledPaths:'<path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2z"/>',disabledPaths:'<path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm9.354 5.354-6 6a.5.5 0 0 1-.708-.708l6-6a.5.5 0 0 1 .708.708z"/>'}},LIGHT:{default:{enabledPaths:'<path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a1.964 1.964 0 0 0-.453-.618A5.984 5.984 0 0 1 2 6zm6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1z"/>',disabledPaths:'<path fill-rule="evenodd" d="M2.23 4.35A6.004 6.004 0 0 0 2 6c0 1.691.7 3.22 1.826 4.31.203.196.359.4.453.619l.762 1.769A.5.5 0 0 0 5.5 13a.5.5 0 0 0 0 1 .5.5 0 0 0 0 1l.224.447a1 1 0 0 0 .894.553h2.764a1 1 0 0 0 .894-.553L10.5 15a.5.5 0 0 0 0-1 .5.5 0 0 0 0-1 .5.5 0 0 0 .288-.091L9.878 12H5.83l-.632-1.467a2.954 2.954 0 0 0-.676-.941 4.984 4.984 0 0 1-1.455-4.405l-.837-.836zm1.588-2.653.708.707a5 5 0 0 1 7.07 7.07l.707.707a6 6 0 0 0-8.484-8.484zm-2.172-.051a.5.5 0 0 1 .708 0l12 12a.5.5 0 0 1-.708.708l-12-12a.5.5 0 0 1 0-.708z"/>'},lightning:{enabledPaths:'<path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09zM4.157 8.5H7a.5.5 0 0 1 .478.647L6.11 13.59l5.732-6.09H9a.5.5 0 0 1-.478-.647L9.89 2.41 4.157 8.5z"/>',disabledPaths:'<path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"/>'}},CHARACTER:{default:{enabledPaths:'<path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>\n  <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>',disabledPaths:'<path fill-rule="evenodd" d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm6.146-2.854a.5.5 0 0 1 .708 0L14 6.293l1.146-1.147a.5.5 0 0 1 .708.708L14.707 7l1.147 1.146a.5.5 0 0 1-.708.708L14 7.707l-1.146 1.147a.5.5 0 0 1-.708-.708L13.293 7l-1.147-1.146a.5.5 0 0 1 0-.708z"/>'}},CAMERA:{default:{enabledPaths:'<path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"/>',disabledPaths:'<path fill-rule="evenodd" d="M10.961 12.365a1.99 1.99 0 0 0 .522-1.103l3.11 1.382A1 1 0 0 0 16 11.731V4.269a1 1 0 0 0-1.406-.913l-3.111 1.382A2 2 0 0 0 9.5 3H4.272l.714 1H9.5a1 1 0 0 1 1 1v6a1 1 0 0 1-.144.518l.605.847zM1.428 4.18A.999.999 0 0 0 1 5v6a1 1 0 0 0 1 1h5.014l.714 1H2a2 2 0 0 1-2-2V5c0-.675.334-1.272.847-1.634l.58.814zM15 11.73l-3.5-1.555v-4.35L15 4.269v7.462zm-4.407 3.56-10-14 .814-.58 10 14-.814.58z"/>'}},DISPLAY:{default:{enabledPaths:'<path d="M0 4s0-2 2-2h12s2 0 2 2v6s0 2-2 2h-4c0 .667.083 1.167.25 1.5H11a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1h.75c.167-.333.25-.833.25-1.5H2s-2 0-2-2V4zm1.398-.855a.758.758 0 0 0-.254.302A1.46 1.46 0 0 0 1 4.01V10c0 .325.078.502.145.602.07.105.17.188.302.254a1.464 1.464 0 0 0 .538.143L2.01 11H14c.325 0 .502-.078.602-.145a.758.758 0 0 0 .254-.302 1.464 1.464 0 0 0 .143-.538L15 9.99V4c0-.325-.078-.502-.145-.602a.757.757 0 0 0-.302-.254A1.46 1.46 0 0 0 13.99 3H2c-.325 0-.502.078-.602.145z"/>',disabledPaths:'<path d="M6 12c0 .667-.083 1.167-.25 1.5H5a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1h-.75c-.167-.333-.25-.833-.25-1.5h4c2 0 2-2 2-2V4c0-2-2-2-2-2H2C0 2 0 4 0 4v6c0 2 2 2 2 2h4z"/>'}},CHAIR:{default:{enabledPaths:'<path d="M445.1 338.6l-14.77-32C425.1 295.3 413.7 288 401.2 288H46.76C34.28 288 22.94 295.3 17.7 306.6l-14.77 32c-4.563 9.906-3.766 21.47 2.109 30.66S21.09 384 31.1 384l.001 112c0 8.836 7.164 16 16 16h32c8.838 0 16-7.164 16-16V384h256v112c0 8.836 7.164 16 16 16h31.1c8.838 0 16-7.164 16-16L416 384c10.91 0 21.08-5.562 26.95-14.75S449.6 348.5 445.1 338.6zM111.1 128c0-29.48 16.2-54.1 40-68.87L151.1 256h48l.0092-208h48L247.1 256h48l.0093-196.9C319.8 73 335.1 98.52 335.1 128l-.0094 128h48.03l-.0123-128c0-70.69-57.31-128-128-128H191.1C121.3 0 63.98 57.31 63.98 128l.0158 128h47.97L111.1 128z"/>',disabledPaths:'<path d="M445.1 338.6l-14.77-32C425.1 295.3 413.7 288 401.2 288H46.76C34.28 288 22.94 295.3 17.7 306.6l-14.77 32c-4.563 9.906-3.766 21.47 2.109 30.66S21.09 384 31.1 384l.001 112c0 8.836 7.164 16 16 16h32c8.838 0 16-7.164 16-16V384h256v112c0 8.836 7.164 16 16 16h31.1c8.838 0 16-7.164 16-16L416 384c10.91 0 21.08-5.562 26.95-14.75S449.6 348.5 445.1 338.6zM111.1 128c0-29.48 16.2-54.1 40-68.87L151.1 256h48l.0092-208h48L247.1 256h48l.0093-196.9C319.8 73 335.1 98.52 335.1 128l-.0094 128h48.03l-.0123-128c0-70.69-57.31-128-128-128H191.1C121.3 0 63.98 57.31 63.98 128l.0158 128h47.97L111.1 128z"/>'}},SHELF:{default:{enabledPaths:'<path d="M2.5 0a.5.5 0 0 1 .5.5V2h10V.5a.5.5 0 0 1 1 0v15a.5.5 0 0 1-1 0V15H3v.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 .5-.5zM3 14h10v-3H3v3zm0-4h10V7H3v3zm0-4h10V3H3v3z"></path>',disabledPaths:'<path d="M2.5 0a.5.5 0 0 1 .5.5V2h10V.5a.5.5 0 0 1 1 0v15a.5.5 0 0 1-1 0V15H3v.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 .5-.5zM3 14h10v-3H3v3zm0-4h10V7H3v3zm0-4h10V3H3v3z"></path>'}},MAP:{default:{enabledPaths:'<path fill-rule="evenodd" d="M3.1 11.2a.5.5 0 0 1 .4-.2H6a.5.5 0 0 1 0 1H3.75L1.5 15h13l-2.25-3H10a.5.5 0 0 1 0-1h2.5a.5.5 0 0 1 .4.2l3 4a.5.5 0 0 1-.4.8H.5a.5.5 0 0 1-.4-.8l3-4z"></path><path fill-rule="evenodd" d="M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999z"></path>',disabledPaths:'<path fill-rule="evenodd" d="M3.1 11.2a.5.5 0 0 1 .4-.2H6a.5.5 0 0 1 0 1H3.75L1.5 15h13l-2.25-3H10a.5.5 0 0 1 0-1h2.5a.5.5 0 0 1 .4.2l3 4a.5.5 0 0 1-.4.8H.5a.5.5 0 0 1-.4-.8l3-4z"></path><path fill-rule="evenodd" d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999z"></path>'}},STORYBOARD:{default:{enabledPaths:'<path d="M0 2.5A1.5 1.5 0 0 1 1.5 1h11A1.5 1.5 0 0 1 14 2.5v10.528c0 .3-.05.654-.238.972h.738a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 1 1 0v9a1.5 1.5 0 0 1-1.5 1.5H1.497A1.497 1.497 0 0 1 0 13.5v-11zM12 14c.37 0 .654-.211.853-.441.092-.106.147-.279.147-.531V2.5a.5.5 0 0 0-.5-.5h-11a.5.5 0 0 0-.5.5v11c0 .278.223.5.497.5H12z"/>\n  <path d="M2 3h10v2H2V3zm0 3h4v3H2V6zm0 4h4v1H2v-1zm0 2h4v1H2v-1zm5-6h2v1H7V6zm3 0h2v1h-2V6zM7 8h2v1H7V8zm3 0h2v1h-2V8zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1z"/>',disabledPaths:'<path d="M0 2.5A1.5 1.5 0 0 1 1.5 1h11A1.5 1.5 0 0 1 14 2.5v10.528c0 .3-.05.654-.238.972h.738a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 1 1 0v9a1.5 1.5 0 0 1-1.5 1.5H1.497A1.497 1.497 0 0 1 0 13.5v-11zM12 14c.37 0 .654-.211.853-.441.092-.106.147-.279.147-.531V2.5a.5.5 0 0 0-.5-.5h-11a.5.5 0 0 0-.5.5v11c0 .278.223.5.497.5H12z"/>\n  <path d="M2 3h10v2H2V3zm0 3h4v3H2V6zm0 4h4v1H2v-1zm0 2h4v1H2v-1zm5-6h2v1H7V6zm3 0h2v1h-2V6zM7 8h2v1H7V8zm3 0h2v1h-2V8zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1z"/>'}},SCRIPT:{default:{enabledPaths:"",disabledPaths:""}}};class c{constructor(t){this._components=[],this._componentsActions=[],this._state=t}get(){return this._state}getPrevious(){return this._previous_state}render(){this._components.forEach((t=>{t.renderComponent()}))}set(t,e){(e||t!==this._state)&&(this._componentsActions.forEach((([,e])=>{e&&e(this.get(),t,this._previous_state)})),this._previous_state=this._state,this._state=t,this._componentsActions.forEach((([,,t])=>{t&&t(this._previous_state,this.get())})),this.render())}subscribe(t){this._components.push(t)}subscribeActions(t,e,s){this._componentsActions.push([t,e,s])}}function l(t){return new c(t)}function d(t,e){return Math.floor(Math.random()*(e-t+1))+t}function h(t,...e){t.removeAttribute("class"),t.classList.add(...e)}function u(t,e,...s){s.forEach((s=>{s&&(s.style[t]=e)}))}function m(t,e,s){const i=document.createElement("g");return function(t,n){t.match(/<path.*?\/>|<path.*?><\/path>/g).forEach((t=>{(t=>{const n=function(t){const e=document.createElement("template");return e.innerHTML=t.trim(),e.content.children[0]}(t);n.style.fill=s||e.color,i.appendChild(n)})(t)}))}(t),i}class p extends class{mount(){this.listen().forEach((t=>{t.subscribe(this)})),this.actions().forEach((([t,e,s])=>{(e||s)&&t.subscribeActions(this,e,s)}))}listen(){return[]}renderComponent(){this.renderInIds().forEach((t=>{const e=this.render(),s=document.getElementById(t);Array.isArray(e)?s.innerHTML=e.join(""):"string"==typeof e?s.innerHTML=e:(s.innerHTML="",s.append(e))})),this.afterRender()}actions(){return[]}renderInIds(){return[]}afterConstructor(){}hook(t,e){this.hookedComponents[t]=e}}{constructor(t){super(),this.ctx=t,[this.ids,this.idCtx]=[this.ctx.ids,this.ctx.idContext],this.snackbarCtx=this.ctx.snackbarCtx,this.overlayCtx=this.ctx.overlayCtx,this.themeCtx=this.ctx.themeCtx,this.getViewportCtx=this.ctx.getViewportGetter(),this.getTimeCtx=this.ctx.getTimeContextGetter(),this.afterConstructor(),this.mount()}}var g;!function(t){t[t.IMAGES=0]="IMAGES",t[t.GENERAL=1]="GENERAL",t[t.STEPS=2]="STEPS",t[t.SCRIPTS=3]="SCRIPTS",t[t.DEBUG=4]="DEBUG"}(g||(g={}));class f extends p{afterConstructor(){this.selectedTabState=l(g.GENERAL)}listen(){return[this.ctx.selectedState,this.ctx.propsState,this.selectedTabState]}renderInIds(){return[this.ids.ROOT_PROP_DIALOG]}actions(){return[[this.ctx.selectedState,()=>{this.selectedTabState.set(g.GENERAL)}],[this.ctx.frameContext.currentFrameState,(t,e)=>{const s=this.ctx.selected;if(s){const i=document.getElementById(this.idCtx.PROP_DIALOG_FOOTER_POSITION(s)),n=document.getElementById(this.idCtx.PROP_DIALOG_FOOTER_SCALE(s));this.updatePositionScaleElements(i,n,s,e,e<t)}}]]}updatePositionScaleElements(t,e,s,i,n){const o=function(t){const e=Object.assign({},t);for(let t in e){const s=e[t];"number"==typeof s&&(e[t]=t.includes("scale")?Math.round(10*s)/10:Math.round(s))}return e}(null==i?this.ctx.getPropPositionByCurrentFrame(s):this.ctx.getPropPositionByFrame(s,i,n));t&&(t.innerText=`(${o.x}, ${o.y}, ${o.degree}°)`,t.style.color=s.color),e&&(e.innerText=`(${o.scaleX}x, ${o.scaleY}x)`,e.style.color=s.color)}afterRender(){const t=t=>{const[e]=this.idCtx.extractIdType(t.target.id);this.ctx.toggleSelected(e)};this.ctx.$(".prop__dialog__close").on("click",(e=>{t(e)})),this.ctx.$(".prop__dialog").on("click",(()=>{this.ctx.selected=null})),this.ctx.$(".prop__dialog--popup").on("click",(t=>{t.stopPropagation()})),this.ctx.$(".header span").on("click",(t=>{this.selectedTabState.set(this.idCtx.extractIdType(t.target.id)[0])})),this.ctx.$(".content .image__container img").on("click",(t=>{this.overlayCtx.overlayOpenState.set(!0),this.overlayCtx.overlayHTMLState.set(`<img src='${t.target.getAttribute("src")}' alt=""/>`)}))}render(){const t=this.ctx.selected;if(t){const e="popup"===this.ctx.config.dialog,s=document.createElement("div");e&&s.classList.add("prop__dialog");const i=document.createElement("div");i.classList.add("prop__dialog--"+(e?"popup":"embedded"),this.ctx.isRootMobile()?"prop__dialog--embedded--mobile":"prop__dialog--embedded--normal"),s.appendChild(i);const n=document.createElement("div");n.classList.add("header");const a=(t,e,s,...i)=>{if(this.ctx.config.alwaysShowAllDialogTabs||s){const s=document.createElement("span");s.title=e,s.classList.add(...i),s.id=this.idCtx.PROP_DIALOG_HEADER_TAB(t),s.classList.add(this.selectedTabState.get()===t?"header__button--selected":"header__button--not-selected"),n.append(s)}};a(g.GENERAL,"General Information",!0,"bi","bi-boxes"),a(g.SCRIPTS,"Scripts",t.script,"bi","bi-journal-bookmark-fill"),a(g.STEPS,"Steps",t.steps,"bi","bi-123"),a(g.IMAGES,"Images",t.images,"bi","bi-image-fill"),a(g.DEBUG,"Debug Information",this.ctx.config.dialogShowAllProperties,"bi","bi-bug");const r=document.createElement("div");r.classList.add("content");const c=(t,e,s)=>{const i=document.createElement("span"),n=document.createElement("span"),o=document.createElement("span");var a;return n.innerHTML=s?`【${a=String(t),(a=a.charAt(0).toUpperCase()+a.slice(1)).replace(/[A-Z]/g,(t=>` ${t}`)).trim()}】 `:`【${String(t)}】 `,n.classList.add("content__key"),o.innerHTML=String(e),o.classList.add("content__value"),i.classList.add("content__key-value"),i.append(n,o),i},l=t=>{const e=document.createElement("div");e.classList.add("image__container","bottom-gray-border");const s=document.createElement("img"),i=document.createElement("span");return i.innerText=t.title?t.title:"",i.classList.add("content-text--normal"),e.append(i),s.src=t.imageURL,e.append(s),e},d=(t,e)=>{const s=document.createElement("div");s.classList.add("step-card","bottom-gray-border");const i=document.createElement("div"),n=document.createElement("span");n.innerText=String(t),n.classList.add("step-card__step");const o=document.createElement("span");o.innerText=e.title?e.title:"",o.classList.add("content-text--normal"),i.append(n,o);const a=document.createElement("span");return a.innerText=e.content?e.content:"",a.classList.add("content-text--normal"),s.append(i,a),s};switch(this.selectedTabState.get()){case g.GENERAL:for(let e in t)o.includes(e)||t.excludeKeys.includes(e)||r.append(c(e,t[e]));t.note&&r.append(c("Note",t.note));break;case g.SCRIPTS:if(t.script){const e=document.createElement("span");e.innerText=t.script,e.classList.add("content-text--normal"),r.append(e)}break;case g.IMAGES:t.images&&t.images.forEach((t=>{r.append(l(t))}));break;case g.STEPS:t.steps&&Object.keys(t.steps).sort(((t,e)=>Number(t)-Number(e))).forEach((e=>{r.append(d(Number(e),t.steps[e]))}));break;case g.DEBUG:switch(this.ctx.config.dialogAllPropertiesFormat){case"flat":const e=function(t){const e={},s=(t,i)=>{Object.keys(t).sort().forEach((n=>{const o=i;i+=`.${n}`,"object"==typeof t[n]?s(t[n],i):e[i.slice(1)]=t[n],i=o}))};return s(t,""),console.log(e),e}(t);for(let t in e)r.append(c(t,e[t],!1));break;case"json":const s=document.createElement("p");s.innerText=JSON.stringify(t,null,2),s.classList.add("content-text--normal"),r.append(s)}}const h=document.createElement("div");h.classList.add("footer");const u=document.createElement("i");u.id=this.idCtx.PROP_DIALOG_CLOSE_ICON(t),u.classList.add("bi","bi-x","pointer","prop__dialog__close"),n.appendChild(u);const m=this.ctx.getPropSVG(t);m.id=this.idCtx.PROP_DIALOG_FOOTER_ICON(t);const p=document.createElement("span");p.innerText=t.name,p.style.color=t.color;const f=document.createElement("span"),b=document.createElement("span");return this.updatePositionScaleElements(f,b,t),f.id=this.idCtx.PROP_DIALOG_FOOTER_POSITION(t),b.id=this.idCtx.PROP_DIALOG_FOOTER_SCALE(t),h.append(m,p,f,b),i.append(n,r,h),s.outerHTML}return""}}class b{constructor(t,e){this.progressFinished=t,this.progressUnfinished=e}static setStyles(t,e,s,i){t.style.width=e,t.style.transitionDuration=s,"0s"==s?t.classList.add("no-transition"):t.classList.remove("no-transition"),i&&(t.style.transitionTimingFunction=i)}full(){b.setStyles(this.progressFinished,"100%","0s"),b.setStyles(this.progressUnfinished,"0%","0s")}reset(){b.setStyles(this.progressFinished,"0%","0s"),b.setStyles(this.progressUnfinished,"100%","0s")}setTransition(t,e,s){b.setStyles(this.progressFinished,s?"100%":"0%",t,e),b.setStyles(this.progressUnfinished,s?"0%":"100%",t,e)}}class _ extends p{constructor(){super(...arguments),this.timeouts=[]}afterConstructor(){this.open=l(!0),this.playing=l(!1)}listen(){return[]}getProgressBars(t){const e=document.getElementById(this.idCtx.FRAME_PROGRESS_FINISHED(t)),s=document.getElementById(this.idCtx.FRAME_PROGRESS_UNFINISHED(t));return s&&e?new b(e,s):null}actions(){const t=(t,e)=>{const s=document.getElementById(this.idCtx.TIMELINE_FRAME(t));s.classList.remove(e?"timeline__frame--not-selected":"timeline__frame--selected"),s.classList.add(e?"timeline__frame--selected":"timeline__frame--not-selected")};return[[this.themeCtx.currentState,null,()=>{const t=this.themeCtx.currentTheme,e=document.getElementById(this.ids.TOOLBAR_THEME_BUTTON),s=e.querySelector("i"),i=e.parentElement.querySelector("span");s&&h(s,...t.icon.split(" ")),i&&(i.innerText=`Theme (${this.themeCtx.themeToDisplay})`)}],[this.open,(t,e)=>{const s=document.getElementById(this.ids.TOOLBAR);if(s){const t=e?0:-(s.getBoundingClientRect().height-45);s.style.bottom=`${t}px`}}],[this.playing,(t,e)=>{const s=document.getElementById(this.ids.TOOLBAR_PLAY_BUTTON),i=s.querySelector("i"),n=s.parentElement.querySelector("span");e?(h(i,"bi","bi-pause-fill"),n.innerText="Pause"):(h(i,"bi","bi-play-fill"),n.innerText="Play")}],[this.ctx.frameContext.currentFrameState,(e,s,i)=>{if(console.log(`Frame: ${i} | ${e} -> ${s}`),null==e)return;const n=this.ctx.getFrameSeconds(e);if(this.getTimeCtx().ifJumpOneLiterally(e,s)){if(t(e,!0),this.timeouts.push(setTimeout((()=>{t(s,!0)}),1e3*n)),null==i||this.getTimeCtx().ifJumpOne(i,e)){const t=this.getProgressBars(e-1);t&&t.full()}const o=this.getProgressBars(e);o&&o.setTransition(n+"s",this.ctx.config.transitionTimingFunction,!0)}else{this.timeouts.forEach((t=>{clearTimeout(t)}));for(let e=1;e<=this.getTimeCtx().totalFrames;e++){t(e,!1);const s=this.getProgressBars(e);s&&s.reset()}t(s,!0)}}]]}renderInIds(){return[this.ids.ROOT_FOOTER]}afterRender(){this.open.set(this.ctx.config.defaultOpenToolbar);const t=(t,e)=>{this.ctx.$(`#${e}`).on("click",(s=>{t(document.getElementById(e),s)}))};this.ctx.$(".toolbar__button").on("mouseenter",(t=>{const e=t.target.parentElement.querySelector("span");e&&e.classList.add("toolbar__tooltip--visible")})),this.ctx.$(".toolbar__button").on("mouseleave",(t=>{const e=t.target.parentElement.querySelector("span");e&&e.classList.remove("toolbar__tooltip--visible")})),this.ctx.$(".timeline__frame").on("click",(t=>{const[e]=this.idCtx.extractIdType(t.target.id);this.ctx.frameContext.currentFrame=e})),t((()=>{this.open.set(!this.open.get())}),this.ids.TOOLBAR_COLLAPSE_BUTTON),t((()=>{this.ctx.viewComponent.resetViewport(),this.snackbarCtx.snackbar="Reset Viewport - Frames Based"}),this.ids.TOOLBAR_RESET_FRAMES_BUTTON),t((()=>{this.ctx.viewComponent.resetViewport(this.ctx.frameContext.currentFrame),this.snackbarCtx.snackbar="Reset Current Viewport"}),this.ids.TOOLBAR_RESET_CURRENT_BUTTON);const e=()=>{if(this.playing.get()){const t=this.ctx.frameContext.nextFrame();setTimeout((()=>{e()}),1e3*this.ctx.getFrameSeconds(t))}};t((()=>{this.playing.set(!this.playing.get()),this.playing.get()&&e()}),this.ids.TOOLBAR_PLAY_BUTTON),t((()=>{navigator.clipboard.writeText(JSON.stringify(this.ctx.config,null,2)).then((()=>this.snackbarCtx.snackbar="Copied to clipboard"))}),this.ids.TOOLBAR_EXPORT_BUTTON),t((()=>{this.themeCtx.next()}),this.ids.TOOLBAR_THEME_BUTTON),t((t=>{t.parentElement.querySelector("span").classList.remove("toolbar__tooltip--visible"),document.fullscreenElement?document.exitFullscreen().then():this.ctx.getRootDocument().requestFullscreen().then()}),this.ids.TOOLBAR_FULLSCREEN)}render(){const t=document.createElement("div"),e=document.createElement("div");e.id=this.ids.TOOLBAR,e.classList.add("toolbar");const s=(t,s,i)=>{const n=document.createElement("div");n.classList.add("toolbar__button-container");const o=document.createElement("div");o.id=i,o.classList.add("button","toolbar__button","pointer");const a=document.createElement("i");a.classList.add(...s.split(" ")),o.append(a);const r=document.createElement("span");r.innerText=t,n.append(o,r),e.append(n)},i=this.ctx.frameContext.currentFrame;if(s("Collapse/Expand","bi bi-arrows-collapse",this.ids.TOOLBAR_COLLAPSE_BUTTON),s("Toggle fullscreen mode","bi bi-arrows-fullscreen",this.ids.TOOLBAR_FULLSCREEN),s("Reset viewport (based on current frame)","bi bi-arrows-move",this.ids.TOOLBAR_RESET_CURRENT_BUTTON),s("Reset viewport (based on all frames)","bi bi-bootstrap-reboot",this.ids.TOOLBAR_RESET_FRAMES_BUTTON),s("Export","bi bi-box-arrow-up-right",this.ids.TOOLBAR_EXPORT_BUTTON),s(`Theme (${this.themeCtx.themeToDisplay})`,this.themeCtx.currentTheme.icon,this.ids.TOOLBAR_THEME_BUTTON),this.ctx.config.displayToolbar&&t.append(e),!this.ctx.frameContext.isStatic){const e=document.createElement("div");e.classList.add("timeline-container"),this.ctx.config.displayToolbar||e.classList.add("timeline-container-full-width");for(let t=0;t<this.getTimeCtx().totalFrames;t++){const s=t+1,n=document.createElement("div");n.classList.add("timeline__frame-container"),s!=this.getTimeCtx().totalFrames&&(n.style.flexGrow=String(Math.floor(10*this.ctx.getFrameSeconds(s))));const o=document.createElement("div");o.classList.add("progress-container");const a=document.createElement("div"),r=document.createElement("div");a.classList.add("progress","progress-finished"),r.classList.add("progress","progress-not"),a.id=this.idCtx.FRAME_PROGRESS_FINISHED(s),r.id=this.idCtx.FRAME_PROGRESS_UNFINISHED(s),o.append(a,r),n.append(o);const c=document.createElement("div");c.id=this.idCtx.TIMELINE_FRAME(s),c.classList.add("timeline__frame",i===s?"timeline__frame--selected":"timeline__frame--not-selected","pointer"),c.innerText=String(s),n.append(c),e.append(n)}s("Play",this.playing.get()?"bi bi-pause-fill":"bi bi-play-fill",this.ids.TOOLBAR_PLAY_BUTTON),this.ctx.config.displayTimeline&&t.append(e)}return t}}class x extends Set{static sortIdTuple(t){return t[0]<t[1]?[t[0],t[1]]:[t[1],t[0]]}addIdTuple(t){return super.add(x.sortIdTuple(t).join(","))}hasIdTuple(t){return super.has(x.sortIdTuple(t).join(","))}}class O extends p{forEachPropWithPosition(t){this.ctx.propsState.get().forEach((e=>{const s=this.ctx.getPropPositionByCurrentFrame(e);s&&t(e,s)}))}}class T extends O{afterConstructor(){this.connections=l(new x)}listen(){return[this.ctx.propsState]}actions(){return[[this.ctx.selectedState,(t,e)=>{if(t){const e=$(`#${this.idCtx.VIEW_PROP(t)}`);e&&e.removeClass("view__prop--selected")}if(e){const t=$(`#${this.idCtx.VIEW_PROP(e)}`);t&&(t.removeClass("view__prop--not-selected"),t.addClass("view__prop--selected"))}}],[this.ctx.frameContext.currentFrameState,(t,e)=>{this.ctx.propsState.get().forEach((s=>{let i=s.frameAnimationConfig[e],n=i&&!i.hide;i=this.ctx.getPropPositionByFrame(s,e,e<t);const o=document.getElementById(this.idCtx.VIEW_PROP(s));o.style.display=n?"unset":"none";const a=document.getElementById(this.idCtx.VIEW_ICON_PATH_GROUP_ENABLED(s)),r=document.getElementById(this.idCtx.VIEW_ICON_PATH_GROUP_DISABLED(s)),c=o.querySelector("image");let l;a&&(a.style.opacity=i.enabled?"1":"0"),r&&(r.style.opacity=i.enabled?"0":"1"),c&&i.thumbnail&&(i.thumbnail.height&&c.setAttributeNS(null,"height",String(i.thumbnail.height)),i.thumbnail.width&&c.setAttributeNS(null,"width",String(i.thumbnail.width))),o.setAttribute("transform",`translate(${i.x}, ${i.y}) rotate(${i.degree}) scale(${i.scaleX} ${i.scaleY})`),l=this.getTimeCtx().ifJumpOne(t,e)?this.ctx.getFrameSeconds(t)+"s":this.ctx.config.frameSelectionSpeed+"s",u("transitionDuration",l,a,r,o,c);const d=this.ctx.getPropPositionByFrame(s,t,!1);d&&u("transitionTimingFunction",d.transitionTimingFunction,a,r,o,c)}))}]]}renderInIds(){return[this.ids.ROOT_VIEW]}applyViewportAttrs(t){const e=this.ctx.$(".view-svg");e.attr("viewBox",`${-this.getViewportCtx().x} ${-this.getViewportCtx().y} ${e.width()*this.getViewportCtx().scale} ${e.height()*this.getViewportCtx().scale}`),t||this.ctx.$(".view__prop").each(((t,e)=>{const s=this.ctx.getPropById(this.idCtx.extractIdType(e.id)[0]);if(s.shouldDisplayName){const t=this.ctx.getPropPositionByCurrentFrame(s),i=e.querySelector("text"),n=document.getElementById(this.idCtx.VIEW_ICON_PATH_GROUP(s,t.enabled?"enabled":"disabled"));console.log(document.getElementById("1-disable-group-icon-prop-view-0"));const o=e.querySelector("image");if(console.log(this.idCtx.VIEW_ICON_PATH_GROUP(s,t.enabled?"enabled":"disabled")),i){const t=i.getBBox().width*s.nameScale,e=i.getBBox().height*s.nameScale,a=o?o.getBBox():n.getBBox();let r,c,l=a.width/2-t/2,d=a.height/2+e/2;switch(console.log(`Path: ${a.width} | Text: ${t} | Shift: ${d}`),s.namePosition){case"top":c=-7,r=l;break;case"bottom":c=a.height+e+7,r=l;break;case"left":c=d,r=Math.floor(-t-a.width);break;case"right":c=d,r=Math.floor(a.width+7);break;case"center":c=d,r=l}i.setAttribute("y",String(s.nameYOffset+c)),i.setAttribute("x",String(s.nameXOffset+r)),i.setAttribute("transform",`scale(${s.nameScale} ${s.nameScale})`)}else s.type,a.STORYBOARD}}))}resetViewport(t){this.getViewportCtx().resetViewport(t),this.applyViewportAttrs()}afterRender(){this.mouse={x:0,y:0},this.dragging=!1,this.resetViewport();const t=t=>{this.dragging&&(t.preventDefault(),this.dragging=!1,$("#"+this.ids.ROOT_VIEW).css("cursor","unset"))},e=t=>{const e=$("#"+this.ids.ROOT_VIEW),s=null==t.touches?t.clientX:t.touches[0].pageX,i=null==t.touches?t.clientY:t.touches[0].pageY;return{x:s-e[0].getBoundingClientRect().left,y:i-e[0].getBoundingClientRect().top}};$("#"+this.ids.ROOT_VIEW).on("mousedown touchstart",(t=>{t.preventDefault(),this.dragging=!0;const s=$("#"+this.ids.ROOT_VIEW);this.mouse=e(t),s.css("cursor","grabbing")})).on("mousemove touchmove",(t=>{if(t.preventDefault(),this.dragging){const s=this.getViewportCtx().offset,i=Object.assign({},this.mouse),n=e(t);this.mouse=n,this.getViewportCtx().offset={x:s.x+n.x-i.x,y:s.y+n.y-i.y},this.applyViewportAttrs(!0)}})).on("mouseup mouseleave touchend touchcancel",(e=>{t(e)})).on("wheel",(t=>{t.preventDefault(),t.originalEvent.deltaY>0?this.getViewportCtx().zoomIn():this.getViewportCtx().zoomOut(),this.applyViewportAttrs(!0)})),this.ctx.$(".view__prop").on("click touchend",(t=>{const e=t.target.id?t.target.id:t.target.parentElement.id;let[s]=this.idCtx.extractIdType(e);this.ctx.toggleSelected(s)}))}createConnections(){let t=[...this.connections.get()].map((t=>{const e=t.split(",").map((t=>Number(t))),s=this.ctx.getPropById(e[0]),i=this.ctx.getPropById(e[1]),n=document.getElementById(this.idCtx.VIEW_GROUP(s)),o=document.getElementById(this.idCtx.VIEW_GROUP(i)),a=this.ctx.getPropPositionByCurrentFrame(s),r=this.ctx.getPropPositionByCurrentFrame(i),c=n.querySelector("text").getBoundingClientRect(),l=o.querySelector("text").getBoundingClientRect();return console.log("bounding: "+a.x+","+a.y),console.log(this.ctx.getPropPositionByCurrentFrame(s)),`<g stroke-width="1" stroke="red"><path d="M${a.x+c.width/2} ${a.y+c.height/2} L${r.x+l.width/2} ${r.y+l.height/2}"/></g>\n<g class="view__prop__connection"><path d="M${a.x} ${a.y} L${r.x} ${r.y}"/></g>`}));document.getElementById(this.ids.VIEW_CONNECTIONS).innerHTML=t.join("")}render(){const t=[];this.ctx.config.lines.forEach((([e,s,i])=>{var n,o,a,r;t.push((n=e.x,o=e.y,a=s.x,r=s.y,`<g stroke-width="${i.width}" stroke="${i.color}"><path d="M${n} ${o}  L${a} ${r}"/></g>`))}));let e=[];this.forEachPropWithPosition(((t,s)=>{var i;const n=s.hide;if(s){const o=this.ctx.propSelected(t),r=document.createElement("g");if(r.classList.add("view__prop",o?"view__prop--selected":"view__prop--not-selected"),r.style.transitionTimingFunction=s.transitionTimingFunction,r.id=this.idCtx.VIEW_GROUP(t),r.setAttribute("transform",`translate(${s.x}, ${s.y}) rotate(${s.degree}) scale(${s.scaleX} ${s.scaleY})`),t.type===a.STORYBOARD){if(s.thumbnail){const t=document.createElementNS("http://www.w3.org/2000/svg","image");null==s.thumbnail.width&&null==s.thumbnail.height&&(s.thumbnail.width=50),s.thumbnail.height&&t.setAttributeNS(null,"height",String(s.thumbnail.height)),s.thumbnail.width&&t.setAttributeNS(null,"width",String(s.thumbnail.width)),t.setAttributeNS("http://www.w3.org/1999/xlink","href",s.thumbnail.imageURL),t.setAttributeNS(null,"x",String(s.x)),t.setAttributeNS(null,"y",String(s.y)),r.append(t)}}else{const e=m(this.ctx.propTypeIconPool[t.type][t.style].enabledPaths,t),s=m(this.ctx.propTypeIconPool[t.type][t.style].disabledPaths,t);e.id=this.idCtx.VIEW_ICON_PATH_GROUP_ENABLED(t),s.id=this.idCtx.VIEW_ICON_PATH_GROUP_DISABLED(t),this.ctx.isPropEnabled(t)?s.style.opacity="0":e.style.opacity="0",r.append(e,s)}if(t.shouldDisplayName){const e=document.createElement("text");e.id=this.idCtx.VIEW_PROP_TEXT(t),e.innerText=t.name,e.style.fill=null!==(i=t.nameColor)&&void 0!==i?i:t.color,r.appendChild(e)}n&&(r.style.display="none"),e.push(r.outerHTML)}}));for(let t in this.ctx.config.attachment){const e=this.ctx.getPropsByName(t);let s=[];this.ctx.config.attachment[t].forEach((t=>{s=s.concat(this.ctx.getPropsByName(t))})),e.forEach((t=>{s.forEach((e=>{t!==e&&this.connections.get().addIdTuple([t.id,e.id])}))}))}return console.log(this.connections.get()),`<svg class="view-svg" xmlns="http://www.w3.org/2000/svg"><g id="${this.ids.VIEW_CONNECTIONS}"></g>${e.join("")}\n<g id="${this.ids.VIEW_LINES_GROUP}">${t.join("")}</g></svg>`}}const E={defaultTheme:"dark",dialog:"embedded",viewOffset:.2,transitionTimingFunction:"linear",frameSpeed:{},attachment:{},defaultFrameSpeed:1,frameSelectionSpeed:1,defaultOpenPropList:!1,defaultOpenToolbar:!1,propTypes:{},lines:[],alwaysShowAllDialogTabs:!1,props:[],renderMethod:"canvas",zoomLowerBound:.15,zoomUpperBound:2,zoomFactor:1.02,dialogShowAllProperties:!0,dialogAllPropertiesFormat:"json",customThemes:{},displayToolbar:!0,displayPropList:!0,displayTimeline:!0};class v extends p{constructor(){super(...arguments),this.timeouts=[]}actions(){return[[this.snackbarCtx.snackbarState,(t,e)=>{const s=document.getElementById(this.ids.SNACKBAR),i=s.querySelector("span");s.classList.remove("snackbar--closed"),i.innerText=e,this.timeouts.forEach((t=>{clearTimeout(t)})),this.timeouts.push(setTimeout((()=>{s.classList.add("snackbar--closed")}),4e3))}]]}renderInIds(){return[this.ids.ROOT_SNACKBAR]}afterRender(){}render(){return`<div class='snackbar snackbar--closed ${this.ctx.isRootMobile()?"snackbar--mobile":"snackbar--normal"}' id="${this.ids.SNACKBAR}"><span></span></div>`}}class S extends p{renderInIds(){return[this.ids.ROOT_OVERLAY]}listen(){return[this.overlayCtx.overlayOpenState,this.overlayCtx.overlayHTMLState]}afterRender(){const t=document.getElementById(this.ids.OVERLAY);t&&(t.onclick=()=>{this.overlayCtx.overlayOpenState.set(!1)})}render(){return this.overlayCtx.overlayOpenState.get()?`<div class='overlay' id="${this.ids.OVERLAY}">\n        ${this.overlayCtx.overlayHTMLState.get()}\n        </div>`:""}}class y{constructor(){this.currentFrameState=l(1),this.totalFramesState=l(0)}get isStatic(){return this.totalFrames<=1}get totalFrames(){return this.totalFramesState.get()}set totalFrames(t){this.totalFramesState.set(t)}get currentFrame(){return this.currentFrameState.get()}set currentFrame(t){this.currentFrameState.set(t)}ifJumpOne(t,e){return e-t==1||1===e&&t===this.totalFrames}ifJumpOneLiterally(t,e){return e-t==1}nextFrame(){const t=this.currentFrame;return this.currentFrame<this.totalFrames?this.currentFrame++:this.currentFrame===this.totalFrames&&(this.currentFrame=1),t}}class L{constructor(t){this.offsetState=l({x:0,y:0}),this.scaleState=l(.75),this.ctx=t}findMinMaxPosition(t){let[e,s,i,n]=[null,null,null,null];const o=t=>{(t.x>i||null==i)&&(i=t.x),(t.y>n||null==n)&&(n=t.y),(t.x<e||null==e)&&(e=t.x),(t.y<s||null==s)&&(s=t.y)};return this.ctx.propsState.get().forEach((e=>{if(t)o(this.ctx.getPropPositionByCurrentFrame(e));else for(let t in e.frameAnimationConfig){const s=e.frameAnimationConfig[t];s&&o(s)}})),[e,s,i,n]}calcViewBox([t,e,s,i]){const n=$(`${this.ctx.rootContainerIdSymbol}`),o=(s-t)/n.width(),a=(i-e)/n.height();let r=o>a?o:a;return r+=this.ctx.config.viewOffset,[r,t-this.ctx.config.viewOffset/2*n.width(),e-this.ctx.config.viewOffset/2*n.height()]}resetViewport(t){const[e,s,i]=this.calcViewBox(this.findMinMaxPosition(t));this.scale=e,this.offset={x:-s,y:-i}}get offset(){return this.offsetState.get()}set offset(t){this.offsetState.set(t)}get scale(){return this.scaleState.get()}set scale(t){t>this.ctx.config.zoomLowerBound&&t<this.ctx.config.zoomUpperBound&&this.scaleState.set(t)}get x(){return this.offset.x}get y(){return this.offset.y}zoomIn(){this.scale=this.scale*this.ctx.config.zoomFactor}zoomOut(){this.scale=this.scale*(1/this.ctx.config.zoomFactor)}}class P{constructor(){this.snackbarMessageState=l("")}get snackbarState(){return this.snackbarMessageState}get snackbar(){return this.snackbarMessageState.get()}set snackbar(t){this.snackbarMessageState.set(t,!0)}}class C{constructor(){this.overlayOpenState=l(!1),this.overlayHTMLState=l("")}}class R extends O{afterRender(){}render(){return`<canvas width="${Math.floor(this.ctx.getRootWidth())}" height="${Math.floor(this.ctx.getRootHeight())}"\n        id="${this.ids.CANVAS}"></canvas>`}resetViewport(t){}}const I={ROOT_SNACKBAR:["snackbar","root__container"],ROOT_PROP_LIST:["prop__list","root__container"],ROOT_PROP_DIALOG:["prop__property","root__container"],ROOT_VIEW:["view","root__container"],ROOT_FOOTER:["footer","root__container"],ROOT_OVERLAY:["overlay","root__container"],VIEW_ICON_PATH_GROUP:["view","prop","icon","group"],VIEW_ICON_PATH_GROUP_ENABLED:["view","prop","icon","group","enabled"],VIEW_ICON_PATH_GROUP_DISABLED:["view","prop","icon","group","disabled"],VIEW_PROP_TEXT:["view","prop","text"],VIEW_GROUP:["view","prop"],VIEW_CONNECTIONS:["view","connections"],VIEW_LINES_GROUP:["view","lines","group"],VIEW_PROP:["view","prop"],OVERLAY:["overlay"],FRAME_PROGRESS_FINISHED:["frame","progress","finished"],FRAME_PROGRESS_UNFINISHED:["frame","progress","unfinished"],TIMELINE_FRAME:["timeline","frame"],TOOLBAR:["toolbar"],TOOLBAR_PLAY_BUTTON:["toolbar","play"],TOOLBAR_FULLSCREEN:["toolbar","fullscreen"],TOOLBAR_COLLAPSE_BUTTON:["toolbar","collapse"],TOOLBAR_RESET_CURRENT_BUTTON:["toolbar","reset","current"],TOOLBAR_RESET_FRAMES_BUTTON:["toolbar","reset","frames"],TOOLBAR_EXPORT_BUTTON:["toolbar","export"],TOOLBAR_THEME_BUTTON:["toolbar","theme"],PROP_DIALOG_CLOSE_ICON:["prop","dialog","property"],PROP_DIALOG_FOOTER_ICON:["prop","dialog","property","icon"],PROP_DIALOG_FOOTER_POSITION:["prop","dialog","footer","position"],PROP_DIALOG_FOOTER_SCALE:["prop","dialog","footer","scale"],PROP_DIALOG_HEADER_TAB:["dialog"],PROP_LIST:["prop","list"],PROP_LIST_ICON:["prop","list","icon"],PROP_LIST_TITLE:["prop","list","icon"],PROP_LIST_HIDE:["prop","list","hide"],PROP_LIST_HIDE_ICON:["prop","list","hide","icon"],SNACKBAR:["snackbar"],CANVAS:["canvas"]};class A{constructor(){this.contextId=A.contextIds,A.contextIds+=1;for(let t in I)this[t]=(e,...s)=>this.getId(e,...s,...I[t])}getType(...t){return this.getId(null,...t)}getId(t,...e){e.sort(((t,e)=>t.localeCompare(e)));const s=null==t?"":"number"==typeof t?"-"+t:null===t.id?"":"-"+t.id;return`${this.contextId}-${e.join("-")}${s}`}extractIdType(t,...e){const s=t.match(/-\d+/),i=t.match(/\d+-/);if(!i||parseInt(i[0].replace("-",""))!=this.contextId)return[-1,[]];let n=-1;return s&&(n=parseInt(s[0].replace("-",""))),[n,t.replace(/-\d+/,"").replace(/\d+-/,"").split("-").filter((t=>!e.includes(t)))]}}A.contextIds=0;class B extends p{afterConstructor(){this.open=l(!0)}listen(){return[this.ctx.propsState]}actions(){return[[this.open,(t,e)=>{const s=this.ctx.getRootDocument().querySelector(".prop__list-container"),i=this.ctx.getRootDocument().querySelector(".hide__icon-rotate-container");e?(s.classList.remove("prop__list-container--closed"),i.classList.remove("icon-animated-right"),i.classList.add("icon-animated-left")):(s.classList.add("prop__list-container--closed"),i.classList.remove("icon-animated-left"),i.classList.add("icon-animated-right"))}],[this.ctx.selectedState,(t,e)=>{const s=document.getElementById(this.idCtx.PROP_LIST(e));this.ctx.propsState.get().forEach((t=>{const e=document.getElementById(this.idCtx.PROP_LIST(t));e&&(e.classList.add("prop__list__item--not-selected"),e.classList.remove("prop__list__item--selected"),e.querySelector("span").style.color=t.color,e.querySelector("path").style.fill=t.color)})),s&&(s.classList.remove("prop__list__item--not-selected"),s.classList.add("prop__list__item--selected"),s.querySelector("span").style.color="var(--scene-base)",s.querySelectorAll("path").forEach((t=>{t.style.fill="var(--scene-base)"})))}]]}renderInIds(){return[this.ids.ROOT_PROP_LIST]}afterRender(){this.open.set(this.ctx.config.defaultOpenPropList),this.ctx.$(".prop__list__item").on("click",(t=>{const[e]=this.idCtx.extractIdType(t.target.id);this.ctx.toggleSelected(e)})),this.ctx.$("#"+this.ids.PROP_LIST_HIDE).on("click",(()=>{this.open.set(!this.open.get())}))}render(){const t=document.createElement("div");t.classList.add("prop__list");const e=document.createElement("div");e.id=this.ids.PROP_LIST_HIDE;const s=document.createElement("div");s.classList.add("icon-animated-left","hide__icon-rotate-container");const i=function(t,...e){const s=document.createElement("i");return t&&(s.id=t),e.forEach((t=>s.classList.add(t))),s}(this.ids.PROP_LIST_HIDE_ICON,"bi","bi-arrow-bar-left");return s.append(i),e.append(s),e.classList.add("hide__icon-container","pointer"),this.ctx.propsState.get().forEach((e=>{const s=this.ctx.propSelected(e)?"var(--scene-base)":e.color,i=document.createElement("div");i.id=this.idCtx.PROP_LIST(e),i.classList.add("pointer","prop__list__item",this.ctx.propSelected(e)?"prop__list__item--selected":"prop__list__item--not-selected");const n=this.ctx.getPropSVG(e,s,1.3);n.id=this.idCtx.PROP_LIST_ICON(e);const o=this.ctx.getPropSpanText(e,s);o.id=this.idCtx.PROP_LIST_TITLE(e),i.append(n,o),t.append(i)})),t.outerHTML+e.outerHTML}}const w={light:{isLight:!0,colors:{"--scene-base":"#ffffff","--scene-base-s1":"#F5F5F5","--scene-base-inv":"#000000","--scene-base-inv-s1":"#1c1c1c","--scene-base-inv-s2":"#696969","--scene-dialog-header-button-not-selected-hover":"#6565a1","--scene-dialog-header-button-not-selected-text-hover":"#6565a1","--scene-snackbar":"#EB7777","--scene-timeline-button-selected":"#8688BC","--scene-timeline-button-selected-hover":"#6565a1","--scene-timeline-button-not-selected":"#EB7777","--scene-timeline-button-not-selected-hover":"#d96262","--scene-timeline-button-text":"#ffffff","--scene-snackbar-text":"#ffffff","--scene-dialog-key":"#6565a1","--scene-dialog-value":"#EB7777","--scene-dialog-content":"#000000","--scene-button-text":"#ffffff","--scene-button-color":"#8688BC","--scene-button-hover":"#6565a1","--scene-trans-base":"rgba(255, 255, 255, 0.95)"},icon:"bi bi-brightness-high"},dark:{isLight:!1,colors:{"--scene-base":"#000000","--scene-base-s1":"#2c2c2c","--scene-base-inv":"#ffffff","--scene-base-inv-s1":"#efefef","--scene-base-inv-s2":"#b4b4b4","--scene-dialog-header-button-not-selected-hover":"#a3a3c7","--scene-dialog-header-button-not-selected-text-hover":"#a3a3c7","--scene-snackbar":"#EB7777","--scene-timeline-button-selected":"#8688BC","--scene-timeline-button-selected-hover":"#6565a1","--scene-timeline-button-not-selected":"#EB7777","--scene-timeline-button-not-selected-hover":"#d96262","--scene-timeline-button-text":"#ffffff","--scene-snackbar-text":"#ffffff","--scene-dialog-key":"#a3a3c7","--scene-dialog-value":"#ea9090","--scene-dialog-content":"#ffffff","--scene-button-text":"#ffffff","--scene-button-color":"#8688BC","--scene-button-hover":"#6565a1","--scene-trans-base":"rgba(40,40,40,0.95)"},icon:"bi bi-moon-stars-fill"},"dark-classic":{isLight:!1,colors:{"--scene-base":"#000000","--scene-base-s1":"#2c2c2c","--scene-base-inv":"#ffffff","--scene-base-inv-s1":"#efefef","--scene-base-inv-s2":"#b4b4b4","--scene-dialog-header-button-not-selected-hover":"#9ab999","--scene-dialog-header-button-not-selected-text-hover":"#9ab999","--scene-snackbar":"#ff857d","--scene-timeline-button-selected":"#375d7e","--scene-timeline-button-selected-hover":"#513c66","--scene-timeline-button-not-selected":"#6d5c7c","--scene-timeline-button-not-selected-hover":"#c06d85","--scene-timeline-button-text":"#ffffff","--scene-snackbar-text":"#ffffff","--scene-dialog-key":"#4c87b5","--scene-dialog-value":"#ff6a79","--scene-dialog-content":"#ffffff","--scene-button-text":"#ffffff","--scene-button-color":"#46aea9","--scene-button-hover":"#557a81","--scene-trans-base":"rgba(40,40,40,0.95)"},icon:"bi bi-balloon-heart-fill"}};class H{constructor(t,e){this._themeKeys=[...Object.keys(t)],this._themes=t;let s=0;e&&(e=e.toLowerCase(),this._themeKeys.includes(e)&&(s=this._themeKeys.indexOf(e))),this._current=l(s),this.renderTheme()}get currentState(){return this._current}get currentTheme(){return this._themes[this._themeKeys[this._current.get()]]}get nextTheme(){return this.getThemeByIndex(this.nextThemeIndex)}renderTheme(){const t=this.currentTheme.colors;for(let e in t)document.documentElement.style.setProperty(e,t[e])}getThemeByIndex(t){return this._themes[this.getThemeName(t)]}getThemeName(t){return this._themeKeys[t]}getNextThemeIndex(t){let e=t+1;return e>=this._themeKeys.length&&(e=0),e}get themeToDisplay(){return`${this.getThemeName(this._current.get())} -> ${this.getThemeName(this.nextThemeIndex)}`}get nextThemeIndex(){return this.getNextThemeIndex(this._current.get())}next(){this._current.set(this.nextThemeIndex),this.renderTheme()}}class M{constructor(t,e){var s,n;this.propIds=0,this._selected=l(),this.propsState=l([]),this.viewportsState=l([]),this.frameContext=new y,this.snackbarCtx=new P,this.overlayCtx=new C,[this.ids,this.idContext]=function(){const t=new A;return[new Proxy(I,{get(e,s,i){var n;if(Reflect.has(e,s)){const o="string"==typeof s&&null!==(n=I[s])&&void 0!==n?n:Reflect.get(e,s,i);return Array.isArray(o)?t.getId(null,...o):o}return null}}),t]}(),this.rootContainerId=t,this.rootContainerIdSymbol="#"+this.rootContainerId,this.config=e?Object.assign(Object.assign({},E),e):Object.assign({},E),this.config.lines.forEach((t=>{t[2]=Object.assign(Object.assign({},i),t[2])})),console.log(this.config),this.propTypeIconPool=Object.assign(Object.assign({},r),e.propTypes),this.themeCtx=(s=Object.assign(Object.assign({},w),this.config.customThemes),n=this.config.defaultTheme,new H(s,n)),this.config.props.forEach((t=>{this.addProp(t)}))}addProp(...t){const e=[...this.propsState.get()];return t.forEach((t=>{var i,o,a,r;if((t=Object.assign(Object.assign({},n),t)).color=(null!==(i=t.color)&&void 0!==i?i:this.themeCtx.currentTheme.isLight)?function(){const t=()=>d(0,125);return`rgb(${t()},${t()},${t()})`}():function(){const t=()=>d(125,255);return`rgb(${t()},${t()},${t()})`}(),t.id=null!==(o=t.id)&&void 0!==o?o:this.propIds,t.name=null!==(a=t.name)&&void 0!==a?a:`${r=t.type,`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()}`} ${t.id}`,t.frameAnimationConfig){t.frameAnimationConfig;for(let e in t.frameAnimationConfig){const i=Object.assign(Object.assign({},s),t.frameAnimationConfig[e]);i.transitionTimingFunction=i.transitionTimingFunction||this.config.transitionTimingFunction,t.frameAnimationConfig[e]=i}}this.propIds+=1,e.push(t)})),this.propsState.set(e),this}get selected(){return this._selected.get()}set selected(t){this._selected.set(t)}get selectedState(){return this._selected}propSelected(t){const e=this.selected,s="number"==typeof t?t:t.id;return e&&e.id===s}getRootDocument(){return document.getElementById(this.rootContainerId)}getRootWidth(){return this.getRootDocument().getBoundingClientRect().width}getRootHeight(){return this.getRootDocument().getBoundingClientRect().height}isRootMobile(){return this.getRootWidth()<500}isPropEnabled(t){return this.getPropPositionByCurrentFrame(t).enabled}getPropById(t){for(const e of this.propsState.get())if(e.id===t)return e;return null}getPropsByName(t){const e=[];for(const s of this.propsState.get())s.name.toLowerCase()===t.toLowerCase()&&e.push(s);return e}getFrameSeconds(t){return t in this.config.frameSpeed?this.config.frameSpeed[t]:this.config.defaultFrameSpeed}getPropPosition(t){let e=t.frameAnimationConfig[this.frameContext.currentFrame];return e=Object.assign({},e),e}getPropPositionByCurrentFrame(t){return this.getPropPositionByFrame(t,this.frameContext.currentFrame,!1)}getPropPositionByFrame(t,e,s){var i;const n=s=>{let i;const n=t.frameAnimationConfig;if(n)if(n[e])i=n[e];else{let t=-1;for(let i in n){const n=Number(i);s?n>e&&(-1===t||Math.abs(n-e)<t)&&(t=n):n<e&&(-1===t||Math.abs(n-e)<t)&&(t=n)}i=n[t]}return i},o=null!==(i=n(s))&&void 0!==i?i:n(!s);return o?Object.assign({},o):null}toggleSelected(t){let e;e="number"==typeof t?this.getPropById(t):t,e===this.selected?this.selected=null:this.selected=e}findMaxFrames(){let t=0;return this.propsState.get().forEach((e=>{const s=e.frameAnimationConfig,i=Number(Object.keys(s).reduce(((t,e)=>s[t]>s[e]?t:e)));i>t&&(t=i)})),t}getViewportGetter(){return()=>this.viewportsState.get()[0]}getTimeContextGetter(){return()=>this.frameContext}beforeDisplay(){this.frameContext.totalFrames=this.findMaxFrames();const t=[];for(let e=0;e<=this.frameContext.totalFrames;e++){const e=new L(this);t.push(e)}this.viewportsState.set(t),this.propsState.set(this.propsState.get().sort(((t,e)=>t.orderIndex<e.orderIndex?-1:t.orderIndex>e.orderIndex?1:0)))}getPropSpanText(t,e){return function(t,e){const s=document.createElement("span");return s.innerText=t,s.style.color=e||"black",s}(t.name,e||t.color)}getPropSVG(t,e,s){s=s||1.4;const i=this.getPathGroup(t,e),n=function(t){const e=function(t,e){const s=document.createElement("svg");return s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("width",String(16)),s.setAttribute("height",String(16)),s.setAttribute("viewBox","0 0 16 16"),s}();return e.setAttribute("transform",`scale(${t} ${t})`),e}(s);return n.append(i),n}getPathGroup(t,e){return m(this.propTypeIconPool[t.type][t.style][this.isPropEnabled(t)?"enabledPaths":"disabledPaths"],t,e)}register(...t){const e=[];return t.forEach((t=>{const s=new t(this);s.renderComponent(),e.push(s)})),e}$(t){return $(`${this.rootContainerIdSymbol} ${t}`)}display(){this.beforeDisplay(),$((()=>{$(`${this.rootContainerIdSymbol}`).addClass("root-container").html(`<div id="${this.ids.ROOT_SNACKBAR}" class='snackbar-container'></div>\n                                     <div id="${this.ids.ROOT_PROP_LIST}" class='prop__list-container'></div>\n                                    <div id="${this.ids.ROOT_PROP_DIALOG}" class='prop__property-container'></div>\n                                    <div id="${this.ids.ROOT_VIEW}" class='view-container'></div>\n                                    <div id="${this.ids.ROOT_FOOTER}" class="footer-container"></div>\n                                    <div id="${this.ids.ROOT_OVERLAY}" class="overlay-container"></div>`);const t="canvas"===this.config.renderMethod?R:T,[e]=this.register(t,f,_,v,S);this.config.displayPropList&&this.register(B),this.viewComponent=e}))}}function F(t,e){const s=()=>{const t=d(5,30)/10;return{enabled:!!d(0,1),x:500*Math.random(),y:500*Math.random(),degree:360*Math.random(),scaleX:t,scaleY:t}},i=()=>({type:"TABLE",brand:"Random",style:"fillSquare",note:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",frameAnimationConfig:{1:s(),2:s(),3:s(),4:s()},script:"Lorem ipsum dolor sit amet, consectetur adipiscing elit,\n123\n\na: c",images:[{title:"test",imageURL:"https://s2.loli.net/2022/02/10/grldkO4LeDjxmY8.png"},{imageURL:"https://s2.loli.net/2022/03/16/KZw7yAWXudMGL21.png"},{title:"A long picture",imageURL:"https://s2.loli.net/2022/03/16/tukpnVKZaUC7GIF.png"}],steps:{11:{title:"Here's step 1",content:"Here's some content"},2:{title:"Here's step 2",content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris"},22:{content:"aha"},21:{},1:{}}});new M(t,{defaultTheme:"light-custom",customThemes:{"light-custom":{icon:"bi bi-arrow-through-heart-fill",isLight:!0,colors:{"--scene-base":"#ffffff","--scene-base-s1":"#F5F5F5","--scene-base-inv":"#000000","--scene-base-inv-s1":"#1c1c1c","--scene-base-inv-s2":"#696969","--scene-dialog-header-button-not-selected-hover":"#355070","--scene-dialog-header-button-not-selected-text-hover":"#355070","--scene-snackbar":"#F765A3","--scene-timeline-button-selected":"#6d597a","--scene-timeline-button-selected-hover":"#6d597a","--scene-timeline-button-not-selected":"#F765A3","--scene-timeline-button-not-selected-hover":"#ea5490","--scene-timeline-button-text":"#ffffff","--scene-snackbar-text":"#ffffff","--scene-dialog-key":"#6d597a","--scene-dialog-value":"#A155B9","--scene-dialog-content":"#000000","--scene-button-text":"#ffffff","--scene-button-color":"#7ec4ef","--scene-button-hover":"#9cabde","--scene-trans-base":"rgba(255, 255, 255, 0.95)"}}},renderMethod:e,frameSpeed:{1:3,2:2,4:.2},attachment:{"table 1":["table 2"],"table 2":["table 1","table 2"]},propTypes:{HOUSE:{default:{enabledPaths:'<path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09zM4.157 8.5H7a.5.5 0 0 1 .478.647L6.11 13.59l5.732-6.09H9a.5.5 0 0 1-.478-.647L9.89 2.41 4.157 8.5z"/>',disabledPaths:'<path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"/>'}}},lines:[],props:[i(),i(),i()]}).display()}return e})()}));